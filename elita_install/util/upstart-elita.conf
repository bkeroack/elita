# elita upstart job file

description "Elita"
author "ben@elita.io"

# Stanzas
#
# Stanzas control when and how a process is started and stopped
# See a list of stanzas here: http://upstart.ubuntu.com/wiki/Stanzas#respawn

# When to start the service
start on runlevel [2345]

# When to stop the service
stop on runlevel [016]

# Essentially lets upstart know the process will detach itself to the background
expect fork

# Start the process
script
    if [ -f /etc/elita/production.ini ]; then
        exec celery -A elita.celeryinit worker -l DEBUG -c 10 -f /var/log/elita/elita-celery-worker.log
        exec pserve --daemon --user=elita --pid-file=/var/lib/elita/elita.pid --log-file=/var/log/elita/elita.log /etc/elita/production.ini
    else
        echo "Error! /etc/elita/production.ini not found"
    fi
end script
